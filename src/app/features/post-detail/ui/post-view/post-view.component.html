@if(this.post()) {
<div *ngIf="post()" class="px-4 pt-4 bg-white w-full rounded-t-lg">
  <div class="flex justify-between">
    <!-- post() author and date -->
    <div class="flex items-center mb-6">
      <img
        [src]="
          post()!.profilePictureUrl || '/assets/images/Sample_User_Icon.png'
        "
        alt="Author's Profile Picture"
        class="size-11 object-cover rounded-full mr-4"
      />
      <div>
        <h4 class="text-xl font-semibold text-gray-800">
          {{ post()!.userName }}
        </h4>
        <p class="text-sm text-gray-500">
          {{ post()!.createdAt | timeAgo }}
        </p>
      </div>
    </div>

    <div class="cursor-pointer relative">
      <button
        (click)="togglePostMenu(post()!, $event)"
        class="p-2 rounded-full hover:bg-gray-200 transition-colors"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          version="1.0"
          viewBox="0 0 512.000000 512.000000"
          preserveAspectRatio="xMidYMid meet"
          class="size-4"
        >
          <g
            transform="translate(0.000000,512.000000) scale(0.100000,-0.100000)"
            fill="#000000"
            stroke="none"
          >
            <path
              d="M381 3054 c-216 -58 -381 -271 -381 -494 0 -177 113 -366 269 -449 200 -106 441 -71 599 87 104 104 152 219 152 362 0 143 -48 258 -152 362 -125 125 -318 178 -487 132z"
            />
            <path
              d="M2433 3055 c-179 -48 -321 -193 -368 -372 -69 -266 100 -547 372 -618 266 -69 547 100 618 372 69 266 -100 547 -372 618 -71 19 -181 18 -250 0z"
            />
            <path
              d="M4485 3056 c-171 -43 -326 -195 -370 -363 -46 -178 5 -363 137 -495 244 -244 657 -175 810 134 78 157 78 299 0 456 -104 211 -349 325 -577 268z"
            />
          </g>
        </svg>
      </button>

      @if (openMenuPostId() === post()!.id) {
      <div
        #postMenu
        (click)="$event.stopPropagation()"
        class="absolute right-0 mt-2 w-56 bg-white rounded-lg shadow-xl z-20 border border-gray-200 py-2"
      >
        <a
          (click)="sharePost(post()!.id, $event)"
          class="flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 cursor-pointer"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="size-5 mr-3"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
            stroke-width="2"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M8.684 13.342C8.886 12.938 9 12.482 9 12s-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.367 2.684 3 3 0 00-5.367-2.684z"
            />
          </svg>
          Скопіювати посилання
        </a>

        @if (post()?.userName === currentUsername) {
        <a
          (click)="deletePost(post()!.id, $event)"
          class="flex items-center px-4 py-2 text-sm text-red-600 hover:bg-gray-100 cursor-pointer"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="size-5 mr-3"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
            stroke-width="2"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"
            />
          </svg>
          Видалити пост
        </a>
        } @else {
        <a
          (click)="reportPost(post()!.id, $event)"
          class="flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 cursor-pointer"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="size-5 mr-3"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
            stroke-width="2"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M3 21v-4m0 0V5a2 2 0 012-2h6.5l1 1H21l-3 6 3 6H8.5l-1-1H5a2 2 0 00-2 2zm9-13.5V9"
            />
          </svg>
          Поскаржитись на пост
        </a>

        }
      </div>
      }
    </div>
  </div>

  <!-- post() categories -->
  <div class="mb-6">
    <p class="text-gray-600 text-sm">
      {{ post()!.categoryNames.join(", ") }}
    </p>
  </div>

  <div class="mb-6">
    <!-- post() content -->
    <div
      class="text-gray-800 text-lg mb-3 break-words whitespace-pre-wra text-wrapp"
      [innerHTML]="sanitizeHtmlContent(post()!.content)"
    ></div>
    <!-- Loop through images -->
    <div *ngIf="post()!.images && post()!.images!.length > 0">
      <div *ngFor="let image of post()!.images">
        <img [src]="image" alt="post() Image" class="w-full" />
      </div>
    </div>
  </div>

  <div class="flex items-center justify-between text-gray-600 text-sm">
    <!-- Like button -->
    <button (click)="onToggleLike()" class="flex items-center group">
      <svg
        xmlns="http://www.w3.org/2000/svg"
        viewBox="0 0 24 24"
        class="size-9 mr-1 transition-all duration-300 hover:bg-gray-300 p-2 rounded-full"
        [ngClass]="{
          'stroke-teal-400 fill-teal-400': isLiked(),
          'stroke-gray-600 group-hover:stroke-teal-400 fill-none': !isLiked()
        }"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"
        />
      </svg>

      <span
        class="ml-1"
        [ngClass]="{
          'text-teal-400 font-semibold': isLiked(),
          'text-gray-600 group-hover:text-teal-400 font-semibold': !isLiked()
        }"
      >
        {{ post()!.likesCount }}
      </span>
    </button>

    <!-- Comment button -->
    <div class="flex items-center group">
      <svg
        xmlns="http://www.w3.org/2000/svg"
        viewBox="0 0 512.000000 512.000000"
        class="size-9 mr-1 p-2 rounded-full transition-all duration-300"
      >
        <g
          transform="translate(0.000000,512.000000) scale(0.100000,-0.100000)"
          fill="currentColor"
          stroke="none"
        >
          <path
            d="M1620 4630 c-254 -10 -506 -25 -758 -46 -221 -18 -306 -41 -415 -114 -123 -82 -206 -192 -255 -334 l-27 -81 0 -1417 c0 -1415 0 -1417 21 -1444 49 -67 130 -91 195 -60 19 9 137 95 263 191 126 96 232 175 235 175 4 0 27 -28 51 -62 80 -109 211 -198 345 -233 94 -24 530 -57 1005 -75 440 -17 1292 -8 1531 15 l56 6 404 -308 c517 -395 463 -358 531 -358 61 0 94 17 132 69 21 27 21 29 21 1444 l0 1417 -27 80 c-83 243 -290 411 -544 440 l-60 7 -11 77 c-23 154 -77 265 -183 371 -102 101 -211 157 -351 179 -67 11 -382 34 -699 51 -247 14 -1191 20 -1460 10z m1195 -320 c293 -11 692 -34 849 -50 161 -16 249 -71 305 -189 l26 -56 0 -810 c0 -923 5 -864 -87 -961 -78 -83 -113 -93 -382 -114 -127 -10 -337 -24 -466 -32 -312 -17 -1328 -17 -1638 0 -128 8 -246 11 -262 7 -17 -4 -169 -112 -350 -251 -177 -134 -323 -244 -325 -244 -3 0 -4 541 -3 1203 l3 1202 26 56 c33 70 87 125 155 156 56 26 181 40 559 63 460 29 1129 37 1590 20z m1640 -724 c66 -30 122 -87 154 -155 l26 -56 3 -1203 c2 -969 0 -1202 -10 -1196 -7 4 -151 112 -320 241 -168 128 -319 238 -335 244 -20 8 -92 7 -268 -3 -312 -17 -1339 -17 -1645 0 -462 27 -693 49 -747 72 -53 22 -131 95 -156 145 l-15 29 56 44 c51 39 61 43 97 38 200 -27 1341 -31 1795 -6 299 16 610 40 685 51 244 39 437 205 517 444 23 70 23 72 26 708 l3 639 42 -7 c23 -4 65 -17 92 -29z"
          />
        </g>
      </svg>
      <span class="ml-2">{{ post()!.commentCount }}</span>
    </div>
  </div>
</div>
} @if (isReportModalOpen()) {
<div
  class="fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-[9999]"
  (click)="closeReportModal()"
>
  <div
    class="bg-white rounded-2xl p-6 w-full max-w-md shadow-xl"
    (click)="$event.stopPropagation()"
  >
    <h3 class="text-xl font-bold mb-4">Поскаржитись на пост</h3>
    <p class="text-sm text-gray-600 mb-6">
      Виберіть причину скарги. Ця дія є анонімною для інших користувачів.
    </p>

    <div class="flex flex-col gap-2">
      @for (reason of reportReasons; track reason) {
      <button
        class="w-full text-left p-3 rounded-lg hover:bg-gray-100 transition-colors border"
        (click)="submitReport(reason)"
      >
        {{ reason }}
      </button>
      }
    </div>

    <button
      class="w-full text-center p-3 mt-6 rounded-lg bg-gray-200 hover:bg-gray-300 font-semibold"
      (click)="closeReportModal()"
    >
      Скасувати
    </button>
  </div>
</div>
} @if (isDeleteConfirmModalOpen()) {
<div
  class="fixed inset-0 bg-black/50 flex justify-center items-center z-50"
  (click)="closeDeleteConfirmModal()"
>
  <div
    class="bg-white rounded-2xl p-6 sm:p-8 w-full max-w-md shadow-xl text-center"
    (click)="$event.stopPropagation()"
  >
    <div
      class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-100"
    >
      <svg
        class="h-6 w-6 text-red-600"
        fill="none"
        stroke="currentColor"
        viewBox="0 0 24 24"
        xmlns="http://www.w3.org/2000/svg"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"
        ></path>
      </svg>
    </div>

    <h3 class="text-xl font-semibold mt-5 mb-2 text-gray-900">
      Підтвердьте видалення
    </h3>
    <p class="text-sm text-gray-500 mb-6">
      Ви впевнені, що хочете видалити цей пост? <br />
      Цю дію неможливо буде скасувати.
    </p>

    <div class="flex justify-center gap-4">
      <button
        class="w-full text-center py-2.5 rounded-lg bg-gray-200 hover:bg-gray-300 font-semibold text-gray-800 transition-colors"
        (click)="closeDeleteConfirmModal()"
      >
        Скасувати
      </button>
      <button
        class="w-full text-center py-2.5 rounded-lg bg-red-600 hover:bg-red-700 font-semibold text-white transition-colors"
        (click)="confirmDelete()"
      >
        Так, видалити
      </button>
    </div>
  </div>
</div>
}
